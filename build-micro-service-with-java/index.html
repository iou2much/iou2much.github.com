<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="AI rules.."><title>【译文】使用Java构建微服务 | Coders' Lab</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.1"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">【译文】使用Java构建微服务</h1><a id="logo" href="/.">Coders' Lab</a><p class="description"></p></div><div id="nav-menu"><a href="/"><i class="fa icon-home"> 首页</i></a><a href="/mindmap/"><i class="fa icon-tree"> 技能树</i></a><a href="/notebook/"><i class="fa icon-home"> Notebook</i></a><a href="/archives/"><i class="fa icon-book"> 归档</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">【译文】使用Java构建微服务</h1><div class="post-meta">Jan 23, 2016<span> | </span><span class="category"><a href="/categories/Translation/">Translation</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#概览"><span class="toc-number">1.</span> <span class="toc-text">概览</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#介绍"><span class="toc-number">2.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#无容器方案"><span class="toc-number">3.</span> <span class="toc-text">无容器方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自成容器方案"><span class="toc-number">4.</span> <span class="toc-text">自成容器方案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-Boot"><span class="toc-number">4.1.</span> <span class="toc-text">Spring Boot</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Wildfly-Swarm"><span class="toc-number">4.2.</span> <span class="toc-text">Wildfly Swarm</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#外置容器方案"><span class="toc-number">5.</span> <span class="toc-text">外置容器方案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker"><span class="toc-number">5.1.</span> <span class="toc-text">Docker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Snoop"><span class="toc-number">5.2.</span> <span class="toc-text">Snoop</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">6.</span> <span class="toc-text">总结</span></a></li></ol></div></div><div class="post-content"><p>by <a href="https://dzone.com/users/1478693/ivargrimstad.html" target="_blank" rel="external">Ivar Grimstad</a>    ·  Oct. 23, 15</p>
<p>本文是我们《Java生态DZone指南》的前篇，由<a href="https://dzone.com/users/1478693/ivargrimstad.html" target="_blank" rel="external">Ivar Grimstad</a>供稿，讲述了如果在容器中用Java构建微服务。</p>
<h2 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h2><ol>
<li>在Java生态系统中构建微服务的策略有三种，分别为：无容器、自成容器、外置容器。</li>
<li>以无容器的方式提供微服务，会把整个应用打包，包含所有依赖，打进一个fat JAR包中。</li>
<li>自成容器的微服务同样也是打成单个JAR包，JAR包中会包含带有第三方类库的嵌入式框架。</li>
<li>外置容器的微服务方式，会把整个Java EE容器和服务的实现打包进一个Docker容器。</li>
</ol>
<p>基于微服务的架构给架构师和开发者带来了新的挑战，不断出现的新语言和开发工具使我们得以应对这个挑战。Java也不例外，本文将探索在Java生态系统中构建微服务的新思路。</p>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>本文不讨论微服务的好坏，也不讨论你是否应该一开始就以微服务架构来设计应用，或者是否应该将已有的庞大应用重构成微服务架构。</p>
<p>这里讨论的方法并不是仅有的方法，但它们会为我们看到其他可能带来启发。虽然本文的重点是Java生态系统，但其中的概念对其他语言和技术也通用。</p>
<p>我在本文命名了几种方式为“无容器”、“自成容器”、“外置容器”。这些术语并未被广泛使用，但是它们能足以区分每种方法的特点，我会在以下小节中讨论。</p>
<h2 id="无容器方案"><a href="#无容器方案" class="headerlink" title="无容器方案"></a>无容器方案</h2><p>在无容器的方式中，开发者把JVM上的所有组件都看作应用的一部分。</p>
<p>无容器的方式使用单个JAR包部署（所谓的”fat JAR部署”），意味着，这个应用以及它所有的依赖，都被打包成一个JAR文件，这个JAR可被作为独立的Java进程启动。</p>
<p><img src="http://7xnyt8.com1.z0.glb.clouddn.com/java-1-cn.png" alt="图1"></p>
<pre><code class="sh">$ java -jar myservice.jar
</code></pre>
<p>这方法其中一个优点是，可以根据需要非常简单地停启服务，以达到扩容或缩容的目的；另一个优势是方便实现分布式部署，只需要同步一个JAR文件就可以了。</p>
<p>另一方面，它的缺点是类库依赖的兼容性问题。例如你需要使应用支持事务特性，你只能靠自己了，或者需要引入支持这个功能是第三方类库。以后，每当你需要支持其他特性，例如说，持久化，就很可能会遇到类库之间的兼容性问题。</p>
<h2 id="自成容器方案"><a href="#自成容器方案" class="headerlink" title="自成容器方案"></a>自成容器方案</h2><p>单JAR包的部署方式有一个变体，就是把你的服务基于一个内置框架构建。通过这种方法，框架可以提供服务所需要的特性，开发者可以自行选择哪些特性被包含在服务内。</p>
<p>你可能会争论说这和”无容器”方案不是一模一样吗？但是，在这我想特地区分开它们，因为“自成容器”的方案实际上会提供一套具兼容性的第三方类库。<br><img src="http://7xnyt8.com1.z0.glb.clouddn.com/java-2-cn.png" alt="图2"></p>
<p>这种方案的实践通常涉及Spring Boot或Wildfly Swarm等框架。</p>
<h3 id="Spring-Boot"><a href="#Spring-Boot" class="headerlink" title="Spring Boot"></a>Spring Boot</h3><p><a href="http://projects.spring.io/spring-boot" target="_blank" rel="external">Spring Boot</a>和<a href="http://cloud.spring.io/spring-cloud-netflix" target="_blank" rel="external">Spring Cloud Netflix</a>项目对构建Java微服务有良好的支持。Spring Boot允许你从Spring系列的组件中挑选不同的部分出来，连同其他出色的外部工具一起，和你的应用打包进一个JAR文件中，<a href="https://start.spring.io/" target="_blank" rel="external">Spring Initializr</a>让你可以通过一个复选列表的表单就完成这些工作。一个简单的Hello World服务在以下例子中可以看到：<a href="https://gist.github.com/ivargrimstad/8bbc2b1085948a38fcdd" target="_blank" rel="external">Gist Snippet</a>。</p>
<h3 id="Wildfly-Swarm"><a href="#Wildfly-Swarm" class="headerlink" title="Wildfly Swarm"></a>Wildfly Swarm</h3><p><a href="http://wildfly.org/swarm" target="_blank" rel="external">WildFly Swarm</a>相当于Jave EE版的Spring Boot，它让你可以挑选Jave EE规范里的组件，并与你的应用同时打包进一个JAR文件中。Hello World示例在此可看到：<a href="https://gist.github.com/ivargrimstad/2d2fee6193e33bc554b7" target="_blank" rel="external">Gist Snippet</a>。</p>
<p>“自成容器”方案的优点在于，你能够自由选择服务所需要的最小集组件。</p>
<p>这个方案不好的地方在于，配置起来稍微复杂些，并且最终生成可交付的JAR包体积会大些，因为它已经包含了容器的特性在里边。</p>
<h2 id="外置容器方案"><a href="#外置容器方案" class="headerlink" title="外置容器方案"></a>外置容器方案</h2><p>然而需要整个Java EE容器才能部署好一个微服务似乎有点大材小用了，有些开发者会争论微服务中的”微”并不一定是这个服务很小或者很简单。<br><img src="http://7xnyt8.com1.z0.glb.clouddn.com/java-3-cn.png" alt="图3"><br>这种情况下，把Java EE容器作为一个必要的基础似乎是适当的。因此，你唯一需要的是Jave EE的API。注意这些依赖已经由容器提供好了，这意味着最终应用的WAR文件会非常小。这种微服务的实现方式和上边的Wildfly Swarm例子一样：<a href="https://gist.github.com/ivargrimstad/c368221fa079285856e7" target="_blank" rel="external">Gist Snippet</a></p>
<p>这种方式的优点是，容器通过标准的API提供了已验证标准功能的实现，因此，作为一个开发者，你可以不关心底层细节，完全集中在业务功能上。</p>
<p>这个方案的另一个优点是，应用层的代码并不依赖于它所部署的Jave EE应用服务器，无论它是<a href="https://glassfish.java.net/" target="_blank" rel="external">GlassFish</a>, <a href="http://wildfly.org/" target="_blank" rel="external">WildFly</a>, <a href="http://www.oracle.com/us/products/middleware/cloud-app-foundation/weblogic/overview/index.html" target="_blank" rel="external">WebLogic</a>, <a href="http://www.ibm.com/software/websphere" target="_blank" rel="external">WebSphere</a>或者任何其他Jave EE兼容的实现。</p>
<p>缺点是你需要把服务部署进一个容器中，所以一定程度上增加了部署的复杂度。</p>
<h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><p><a href="https://www.docker.com/" target="_blank" rel="external">Docker</a>现在要出场了，通过把Java EE容器和服务的实现打包进一个Docker镜像，可以达到和单JAR包方式部署差不多的效果，不同之处是服务是打包进一个Docker镜像而不是一个JAR包了。</p>
<pre><code class="sh">Dockerfile 

FROM jboss/wildfly:9.0.1.Final ADD myservice.war /opt/jboss/wildfly/standalone/deployments
</code></pre>
<p>通过启动Docker引擎中的镜像来开启这个服务。</p>
<pre><code class="sh">$ docker run -it -p 8081:8080 myorganization/myservice
</code></pre>
<h3 id="Snoop"><a href="#Snoop" class="headerlink" title="Snoop"></a>Snoop</h3><p>细心的读者可能注意到前边Spring Boot示例中的<code>@EnableEurekaClient</code>注解，这个注解通过Eureka把服务注册了，让它能被服务的消费者发现。<a href="https://github.com/Netflix/eureka/wiki/Eureka-at-a-glance" target="_blank" rel="external">Eureka</a>是Spring Cloud Netflix工具集的一部分，能极度简化服务发现的配置。</p>
<p>Java EE并没有提供这个特性，但是相应的有几个开源的方案。其中一个是<a href="https://github.com/ivargrimstad/snoop" target="_blank" rel="external">Snoop</a>，与Eureka有<a href="https://github.com/ivargrimstad/snoop" target="_blank" rel="external">类似的功能</a>，要使Java EE微服务能被路由到，唯一一件事要做的是使用@EnableSnoopClient注释，详见示例：<a href="https://gist.github.com/ivargrimstad/34bfe4b5368a35d30007" target="_blank" rel="external">Gist Snippet</a></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>要构建微服务，Java是一个非常好的选择，本文中提到的任何一个方案都可以实现。最适合的方案视乎服务的具体需求。对于相对简单的服务来说，“无容器”或”自成容器”是更好的选择，但是使用外置容器的方式，能更快捷简单地构建更复杂的服务。无论是哪种方案，要实现微服务，使用Java生态圈的组件都是被验证过的。</p>
<p>欢迎来到DZone社区，这里有更多关于微服务，JVM语言，和Java的发展趋势的文章。</p>
</div><script type="text/javascript" src="/js/share.js?v=0.1" async></script><a data-url="http://ai-code.tech/build-micro-service-with-java/" data-id="ciy9g3pim001dk4ttqnpdolx0" class="article-share-link">分享到</a><div class="tags"></div><div class="post-nav"><a href="/build-my-site-2/" class="pre">【debug.life构建手记】 ( 二 ) Hexo静态博客搭建及配置</a><a href="/build-my-site-1/" class="next">【debug.life构建手记】 ( 一 ) 基础设施搭建</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tools/">Tools</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Translation/">Translation</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/Node-js/" style="font-size: 15px;">Node.js</a> <a href="/tags/Mac-OS-X/" style="font-size: 15px;">Mac OS X</a> <a href="/tags/Docker/" style="font-size: 15px;">Docker</a> <a href="/tags/Openresty/" style="font-size: 15px;">Openresty</a> <a href="/tags/Aliyun/" style="font-size: 15px;">Aliyun</a> <a href="/tags/https/" style="font-size: 15px;">https</a> <a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/build-with-docker/">用Docker容器编译软件</a></li><li class="post-list-item"><a class="post-list-link" href="/startup-micro-service-with-ruby/">【译文】使用Ruby on Rails和Docker开始微服务之旅</a></li><li class="post-list-item"><a class="post-list-link" href="/what-would-docker-bring-to-your-team/">【译文】Docker会给你的开发团队带来什么变化？</a></li><li class="post-list-item"><a class="post-list-link" href="/how-to-use-docker-to-build-mapr-cluster/">【译文】如何使用Docker创建开箱即用的MapR集群</a></li><li class="post-list-item"><a class="post-list-link" href="/opensource-docker-n-java-projects/">【译文】Java项目与Docker</a></li><li class="post-list-item"><a class="post-list-link" href="/build-my-site-3/">【debug.life构建手记】 ( 三 ) Docker化本站</a></li><li class="post-list-item"><a class="post-list-link" href="/build-my-site-2/">【debug.life构建手记】 ( 二 ) Hexo静态博客搭建及配置</a></li><li class="post-list-item"><a class="post-list-link" href="/build-micro-service-with-java/">【译文】使用Java构建微服务</a></li><li class="post-list-item"><a class="post-list-link" href="/build-my-site-1/">【debug.life构建手记】 ( 一 ) 基础设施搭建</a></li><li class="post-list-item"><a class="post-list-link" href="/Docker-difference-between-container-n-vms/">【译文】Docker:容器与虚拟机的差异</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://notebook.debug.life/tree" title="Notebook" target="_blank">Notebook</a><ul></ul><a href="http://jupyter.debug.life/" title="Jupyter" target="_blank">Jupyter</a><ul></ul><a href="http://www.lancezhange.com/" title="Hexo大牛" target="_blank">Hexo大牛</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Coders' Lab.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.1" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.1" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.1"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?4492c5298a95d05e162aa9bd5f8b145b";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.1"></script><script type="text/javascript" src="/js/smartresize.js?v=0.1"></script></div></body></html>